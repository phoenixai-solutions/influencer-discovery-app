<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Phyllo Connect â€“ Staging</title>

    <!-- Phyllo Connect Web SDK (v2 per docs) -->
    <script src="https://cdn.getphyllo.com/connect/v2/phyllo-connect.js"></script>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f5f7fb;
        padding: 40px;
        text-align: center;
      }
      h2 {
        margin-bottom: 0.5rem;
      }
      p {
        margin-bottom: 1.5rem;
      }
      button {
        font-size: 16px;
        padding: 12px 24px;
        border-radius: 999px;
        background: #111827;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #000;
      }
      pre {
        margin-top: 2rem;
        text-align: left;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        background: #ffffff;
        border-radius: 12px;
        padding: 12px 16px;
        border: 1px solid #e5e7eb;
        font-size: 12px;
        white-space: pre-wrap;
      }
    </style>
  </head>

  <body>
    <h2>Phyllo Connect â€“ Staging</h2>
    <p>Click below to connect your real social account via Phyllo Staging.</p>

    <button id="connectBtn">Connect Account</button>

    <pre id="debug"></pre>

    <script>
      // ðŸ‘‰ Paste your SDK token from PowerShell here:
      const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWQzZTU0ZWItOTc5Ny00OThhLTk4YTEtMDY0MDUyMGQzMzk2IiwidGVuYW50X2lkIjoiZGQzOTEwMGEtNjBkNC00NzQzLWExNTktMzNmMTJlZTdkMjU3IiwidGVuYW50X2FwcF9pZCI6IjU4OThmNTRjLTRiNmUtNDJmMi1iMTc1LTA0YTQ5Yjc2NGViNCIsInByb2R1Y3RzIjpbIkVOR0FHRU1FTlQiLCJFTkdBR0VNRU5UX0FVRElFTkNFIiwiSURFTlRJVFkiXSwiaXNzIjoiaHR0cHM6Ly9hcGkuZ2V0cGh5bGxvLmNvbSIsImF1ZCI6Imh0dHBzOi8vYXBpLmdldHBoeWxsby5jb20vdjEvaW50ZXJuYWwiLCJpYXQiOjE3NjM4MzgwMzAuMzQ2MjgyLCJleHAiOjE3NjQ0NDI4MzAuMzQ2Mjc3fQ.CuBvG5e6RKlxjxVT1-snPzAgjILqxcm9R1S51Y7eB0s";

      const debugEl = document.getElementById("debug");
      function log(msg, obj, isError) {
        const time = new Date().toISOString();
        const icon = isError ? "âŒ" : "â„¹ï¸";
        debugEl.textContent += `[${time}] ${icon} ${msg}\n`;
        if (obj) {
          debugEl.textContent += JSON.stringify(obj, null, 2) + "\n";
        }
      }

      log("Page JS loaded.");

      // Small delay to give the SDK script time to attach (just in case)
      setTimeout(() => {
        log("typeof window.PhylloConnect:", typeof window.PhylloConnect);
        log("typeof window.Phyllo:", typeof window.Phyllo);
        // Dump any global keys that look like "phyllo..."
        const keys = [];
        for (const k in window) {
          if (k.toLowerCase().includes("phyllo")) keys.push(k);
        }
        log("Window keys containing 'phyllo':", keys);
      }, 500);

      document.getElementById("connectBtn").onclick = () => {
        log("Connect button clicked.");

        if (!window.PhylloConnect) {
          log(
            "PhylloConnect SDK not found on window. Check Network tab for phyllo-connect.js (should be 200).",
            null,
            true
          );
          alert("PhylloConnect SDK failed to load.");
          return;
        }

        const config = {
          token,
          environment: "sandbox", // 'sandbox' or 'production'
          // userId is inside the token for v2; we don't need to pass it explicitly
          clientDisplayName: "Phoenix / Damien Staging Test"
        };

        log("Initialising PhylloConnect with config:", config);

        try {
          const phylloConnect = window.PhylloConnect.initialize(config);

          // Optional event hooks
          phylloConnect.on("accountConnected", (accountId, workPlatformId, userId) => {
            log("accountConnected:", { accountId, workPlatformId, userId });
          });

          phylloConnect.on("accountDisconnected", (accountId, workPlatformId, userId) => {
            log("accountDisconnected:", { accountId, workPlatformId, userId });
          });

          phylloConnect.on("exit", (reason, userId) => {
            log("exit:", { reason, userId });
          });

          log("Opening Phyllo Connect UI...");
          phylloConnect.open();
        } catch (e) {
          log("Error during PhylloConnect.initialize/open:", { error: e.message }, true);
          alert("Error initialising PhylloConnect: " + e.message);
        }
      };
    </script>
  </body>
</html>
