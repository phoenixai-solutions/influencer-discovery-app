<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creator Discovery | Aruba Tourism</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    body { background:#f9fafb; font-family:'Inter',sans-serif; }
    .input { border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; font-size:14px; width:100%; }
    .label { font-size:12px; color:#6b7280; margin-bottom:6px; display:block; }
    .field { display:flex; flex-direction:column; }
    .filters-row { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }
    .btn { border-radius:12px; padding:8px 16px; font-size:14px; font-weight:500; cursor:pointer; }
    .btn-primary { background:#0f172a; color:#fff; }
    .btn-outline { border:1px solid #e5e7eb; background:#fff; color:#111827; }
    .btn-outline:hover { background:#f9fafb; }
    .advanced.hidden { display:none; }
    .advanced { margin-top:16px; border-top:1px solid #e5e7eb; padding-top:16px; display:grid; gap:14px; }
    .group { background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:12px; }
    .group-title { font-size:11px; text-transform:uppercase; color:#64748b; font-weight:600; margin-bottom:8px; }
    .group-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }
    @media(max-width:1024px){ .filters-row{grid-template-columns:1fr 1fr;} .group-grid{grid-template-columns:1fr 1fr;} }
    .platform-bar { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px; }
    .platform-btn { display:flex; align-items:center; gap:6px; padding:8px 14px; border-radius:9999px; border:1px solid #e5e7eb; background:#fff; color:#111827; font-size:14px; font-weight:500; cursor:pointer; }
    .platform-btn.active { background:#0f172a; color:#fff; border-color:#0f172a; }
    .platform-btn svg { width:16px; height:16px; }
    .auto-wrap { position:relative; }
    .auto-list { position:absolute; top:105%; left:0; right:0; background:#fff; border:1px solid #e5e7eb; border-radius:8px; max-height:180px; overflow:auto; z-index:20; }
    .auto-list div { padding:8px 12px; cursor:pointer; font-size:14px; }
    .auto-list div:hover { background:#f3f4f6; }
    .results { margin-top:30px; background:white; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden; }
    .results table { width:100%; border-collapse:collapse; }
    .results th, .results td { padding:10px 14px; font-size:14px; border-bottom:1px solid #e5e7eb; text-align:left; }
    .results th { background:#f9fafb; text-transform:uppercase; font-size:12px; color:#6b7280; }
    .avatar { width:36px; height:36px; border-radius:50%; object-fit:cover; margin-right:8px; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-lg font-semibold text-gray-800">Creator Discovery</h1>
      <nav class="space-x-4 text-sm text-gray-600">
        <a class="font-semibold text-gray-900" href="#">Find Influencers</a>
        <a href="#">Manage Influencers</a>
        <a href="#">Campaigns</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="bg-white border border-gray-200 rounded-2xl p-5 shadow-sm">

      <!-- Inline SVGs -->
      <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
        <!-- (same icon set you already have: ig, tt, yt, tw, twch) -->
      </svg>

      <!-- Platform bar -->
      <div id="platformBar" class="platform-bar"></div>

      <!-- Core filters -->
      <div class="filters-row">
        <div class="field"><label class="label">Topic / Keywords</label><input id="kw" class="input" placeholder="e.g. #travel, foodie" /></div>
        <div class="field"><label class="label">Location</label><div class="auto-wrap"><input id="location" class="input" autocomplete="off"/><div id="locList" class="auto-list hidden"></div></div></div>
        <div class="field"><label class="label">Language</label><div class="auto-wrap"><input id="lang" class="input" autocomplete="off"/><div id="langList" class="auto-list hidden"></div></div></div>
        <div class="field"><label class="label">Gender</label><select id="gender" class="input"><option value="">Any</option><option value="female">Female</option><option value="male">Male</option></select></div>
      </div>

      <!-- Advanced toggle -->
      <div class="flex justify-start mt-3">
        <button id="btnAdvanced" class="btn btn-outline">Advanced filters ▾</button>
      </div>

      <!-- Advanced filters -->
      <div id="advancedPanel" class="advanced hidden">
        <div class="group">
          <div class="group-title">Creator Quality</div>
          <div class="flex flex-wrap gap-4">
            <label class="flex items-center gap-2 text-sm text-gray-700"><input id="verified" type="checkbox"> Verified</label>
            <label class="flex items-center gap-2 text-sm text-gray-700"><input id="excludePrivate" type="checkbox" checked> Exclude Private</label>
            <label class="flex items-center gap-2 text-sm text-gray-700"><input id="hasEmail" type="checkbox"> Has Email</label>
          </div>
        </div>
      </div>

      <div class="flex justify-end mt-5">
        <button id="btnSearch" class="btn btn-primary">Search</button>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsContainer" class="results hidden">
      <div id="loading" class="text-center py-4 text-gray-500 hidden">Loading...</div>
      <table id="resultsTable">
        <thead>
          <tr><th>Creator</th><th>Platform</th><th>Followers</th><th>ER %</th><th>Country</th><th>Email</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="noResults" class="text-center py-4 text-gray-500 hidden">No results found.</div>
    </div>
  </main>

  <script>
    const PLATFORM_OPTIONS = [
      { key:"instagram",label:"Instagram",icon:"#ig" },
      { key:"tiktok",label:"TikTok",icon:"#tt" },
      { key:"youtube",label:"YouTube",icon:"#yt" },
      { key:"twitch",label:"Twitch",icon:"#twch" },
      { key:"twitter",label:"X",icon:"#tw" }
    ];
    let platform="instagram";
    const bar=document.getElementById("platformBar");
    PLATFORM_OPTIONS.forEach(p=>{
      const b=document.createElement("button");
      b.className="platform-btn"+(p.key==="instagram"?" active":"");
      b.innerHTML=`<svg><use href="${p.icon}"/></svg>${p.label}`;
      b.onclick=()=>{document.querySelectorAll(".platform-btn").forEach(btn=>btn.classList.remove("active"));b.classList.add("active");platform=p.key;};
      bar.appendChild(b);
    });

    document.getElementById("btnAdvanced").addEventListener("click",()=>{
      const p=document.getElementById("advancedPanel");
      p.classList.toggle("hidden");
      document.getElementById("btnAdvanced").textContent=p.classList.contains("hidden")?"Advanced filters ▾":"Advanced filters ▴";
    });

    // Fetch helper
    function n(v){const num=Number(v);return Number.isFinite(num)?num:null;}
    function any(v){return v!==undefined&&v!==null&&String(v).trim()!=="";}
    function pack(obj){const out={};Object.entries(obj).forEach(([k,v])=>{
      if(v==null)return;if(Array.isArray(v)&&!v.length)return;
      if(typeof v==="object"&&!Array.isArray(v)){
        const keep=Object.fromEntries(Object.entries(v).filter(([,vv])=>vv!==null&&vv!==undefined&&vv!==""));
        if(Object.keys(keep).length)out[k]=keep;
      } else if(v!=="") out[k]=v;
    });return out;}

    // Load lists
    async function loadList(id,url){
      const input=document.getElementById(id);
      const list=document.getElementById(id+"List");
      const data=await fetch(url).then(r=>r.json());
      input.addEventListener("input",()=>{
        const v=input.value.toLowerCase();list.innerHTML="";if(!v){list.classList.add("hidden");return;}
        const filtered=data.map(i=>typeof i==="string"?i:i.label).filter(l=>l.toLowerCase().includes(v)).slice(0,20);
        filtered.forEach(l=>{const div=document.createElement("div");div.textContent=l;div.onclick=()=>{input.value=l;list.classList.add("hidden");};list.appendChild(div);});
        list.classList.remove("hidden");
      });
      document.addEventListener("click",(e)=>{if(!list.contains(e.target)&&e.target!==input)list.classList.add("hidden");});
    }
    loadList("location","/data/locations.json");
    loadList("lang","/data/languages.json");

    // SEARCH
    document.getElementById("btnSearch").addEventListener("click", async () => {
      const resultsContainer=document.getElementById("resultsContainer");
      const tbody=document.querySelector("#resultsTable tbody");
      const loading=document.getElementById("loading");
      const noResults=document.getElementById("noResults");
      resultsContainer.classList.remove("hidden");
      loading.classList.remove("hidden");
      tbody.innerHTML=""; noResults.classList.add("hidden");

      const payload={
        platform,
        paging:{limit:50,page:1},
        sort:{sort_by:"relevancy",sort_order:"desc"},
        filters:pack({
          ai_search:kw.value,
          location:[location.value],
          profile_language:[lang.value],
          gender:gender.value,
          is_verified:verified.checked,
          exclude_private_profile:excludePrivate.checked,
          has_email:hasEmail.checked
        }),
        last_post:"30d"
      };

      try {
        const res = await fetch("https://hook.eu2.make.com/sjswwb2atmu5ja8cvxmj0r38uw9bod5v", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        loading.classList.add("hidden");

        if (!data || !data.length) {
          noResults.classList.remove("hidden");
          return;
        }

        data.forEach(item=>{
          const tr=document.createElement("tr");
          const email=item.email?"✅":"❌";
          tr.innerHTML=`
            <td><div class="flex items-center"><img src="${item.profile_picture_url||''}" class="avatar"/><div><div class="font-medium">${item.full_name||'—'}</div><div class="text-sm text-gray-500">@${item.username||''}</div></div></div></td>
            <td>${item.platform||platform}</td>
            <td>${item.followers?.toLocaleString()||'—'}</td>
            <td>${item.engagement_rate?item.engagement_rate.toFixed(2):'—'}%</td>
            <td>${item.country||'—'}</td>
            <td>${email}</td>
            <td><a href="influencer-details.html?id=${item.id}" class="text-blue-600 hover:underline">View Details</a></td>`;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error(err);
        loading.classList.add("hidden");
        noResults.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
